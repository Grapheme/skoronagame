function startOrSearch(){GAME.getGame()}function scale(){var e=$(window).width();$("#map").transition({scale:e/bg_width})}function openFrame(e){"close"==e?_history.pop():_history.push(e),"mathcmaking"==e&&startOrSearch();var s=_history[_history.length-1];$(".popup-wrapper .popup-holder .popup").removeClass("active"),$(".popup-wrapper .popup-holder .popup#"+s).addClass("active")}var GAME=GAME||{};GAME.game_id=0,GAME.user={},GAME.status=0,GAME.stage=0,GAME.response={},GAME.map={},GAME.question={},GAME.steps=0,GAME.user_step=0,GAME.statuses=["wait","start","ready","over"],GAME.timer={timer_object:{},time:10},GAME.getGame=function(){$.ajax({type:"POST",url:"/game/get-game",data:{game:GAME.game_id},dataType:"json",beforeSend:function(){$("#js-server-response").html("")},success:function(e){e.status&&(GAME.response=e.responseJSON,GAME.map=GAME.response.map,GAME.parseGameResponse()),console.log(GAME),console.log(e)},error:function(e,s,t){}})},GAME.getQuizQuestion=function(){$.ajax({type:"POST",url:"/game/question/get-quiz",data:{game:GAME.game_id},dataType:"json",beforeSend:function(){$("#js-server-response").html("")},success:function(e){e.status&&(GAME.user_step=0,GAME.response=e.responseJSON,GAME.question.id=GAME.response.question.id,GAME.question.text=GAME.response.question.text,GAME.question.type=GAME.response.question.type,GAME.parseQuestionResponse(),$("#js-server-response").html(JSON.stringify(GAME.response))),$("#js-server-notification").html(e.responseText)},error:function(e,s,t){}})},GAME.sendQuestionAnswer=function(){$.ajax({type:"POST",url:"/game/question/send-answer",data:{game:GAME.game_id,question:GAME.question.id,answer:GAME.question.answer,time:GAME.question.time},dataType:"json",beforeSend:function(){$("#js-server-response").html("")},success:function(e){e.status&&(GAME.response=e.responseJSON,$("#js-server-response").html(JSON.stringify(GAME.response))),$("#js-question-result").parent().show(),$("#js-server-notification").html(e.responseText)},error:function(e,s,t){}})},GAME.getResultQuestion=function(){$.ajax({type:"POST",url:"/game/question/get-result",data:{game:GAME.game_id,question:GAME.question.id},dataType:"json",beforeSend:function(){$("#js-server-response").html("")},success:function(e){e.status&&(GAME.response=e.responseJSON,GAME.parseResultQuestionResponse(),console.log(GAME))},error:function(e,s,t){}})},GAME.sendConquestEmptyTerritory=function(e){$.ajax({type:"POST",url:"/game/conquest/territory",data:{game:GAME.game_id,zone:$(e).data("zone")},dataType:"json",beforeSend:function(){$("#js-server-response").html("")},success:function(s){s.status&&($(e).css("background-color",GAME.user.color).attr("data-user",GAME.user.id).html("Zona: "+$(e).data("zone")+"<br>ID: "+$(e).data("zone_id")+"<br>User: "+$(e).data("user")+"<br>Lives: "+$(e).data("lives")),GAME.response=s.responseJSON,GAME.steps--,0==GAME.steps&&$("#js-question-game").parent().show(),$("#js-server-response").html(JSON.stringify(GAME.response))),$("#js-server-notification").html(s.responseText)},error:function(e,s,t){}})},GAME.sendConquestTerritory=function(e){},GAME.parseGameResponse=function(){GAME.game_id=GAME.response.game_id,GAME.status=GAME.response.game_status,GAME.stage=GAME.response.game_stage,GAME.user_step=GAME.response.settings.next_step,$.each(GAME.response.users,function(e,s){s.id==GAME.response.current_user&&(GAME.user=s,$("#js-user-response").html(JSON.stringify(GAME.user)))}),GAME.status==GAME.statuses[1]?(GAME.createMap(),GAME.user_step==GAME.user.id&&(GAME.stage=1,GAME.getQuizQuestion())):GAME.status==GAME.statuses[2]&&(GAME.updateMap(),0==GAME.user_step&&(1==GAME.stage&&$.isEmptyObject(GAME.question)?GAME.getQuizQuestion():2==GAME.stage))},GAME.parseQuestionResponse=function(){1==GAME.stage?GAME.question.id>0?($("#js-question-game").parent().hide(),$("#quiz-question-text").html(GAME.question.text),$("#quiz-question-block").show(),GAME.startTimer()):GAME.getQuizQuestion():2==GAME.stage&&GAME.question.id>0&&($("#js-question-game").parent().show(),$("#normal-question-block").show())},GAME.parseResultQuestionResponse=function(){1==GAME.stage?"standoff"===GAME.response.result?(GAME.question={},GAME.getQuizQuestion(),$("#js-question-result").parent().hide(),$("#js-question-game").parent().show()):"retry"===GAME.response.result?(GAME.getResultQuestion(),$("#js-question-result").parent().hide(),$("#js-question-game").parent().hide()):"object"==typeof GAME.response.result&&(GAME.question={},$("#js-question-result").parent().hide(),$("#js-question-game").parent().hide(),GAME.steps=Math.abs(GAME.response.result[GAME.user.id]-3)):2==GAME.stage},GAME.createMap=function(){var e=$("#map-block-template"),s="";$.each(GAME.map,function(t,a){s=a.user_id>0?"js-map-block":"js-map-empty-block",a.lives>1&&(s="js-map-capital-block"),$(e).clone(!0).appendTo($("#russia-map-blocks")).removeAttr("id").addClass(s).attr("data-zone",a.zone).attr("data-lives",a.lives).attr("data-user",a.user_id).attr("data-zone_id",a.id).css("background-color",a.settings.color).html("Zona: "+a.zone+"<br>ID: "+a.id+"<br>User: "+a.user_id+"<br>Lives: "+a.lives)}),$("#map-block-template").remove(),$("#russia-map").show()},GAME.updateMap=function(){(GAME.isEmptyMap===!1||0==$(".js-map-block").length)&&GAME.createMap();var e="";$.each(GAME.map,function(s,t){e=t.user_id>0?"js-map-block":"js-map-empty-block",t.lives>1&&(e="js-map-capital-block"),$(".territory-block[data-zone='"+t.zone+"']").addClass(e).attr("data-zone",t.zone).attr("data-lives",t.lives).attr("data-user",t.user_id).attr("data-zone_id",t.id).css("background-color",t.settings.color).html("Zona: "+t.zone+"<br>ID: "+t.id+"<br>User: "+t.user_id+"<br>Lives: "+t.lives)})},GAME.startTimer=function(){var e=GAME.timer.time,s=$("#"+GAME.question.type+"-question-timer span");s.text(e).parent("p"),GAME.question.time=0,GAME.timer.timer_object=setInterval(function(){s.text(--e),GAME.question.time=GAME.question.time+1||1,0>=e&&(clearInterval(GAME.timer.timer_object),GAME.question.answer=null,GAME.sendQuestionAnswer(),$("#"+GAME.question.type+"-question-block").hide())},1e3)},GAME.isEmptyMap=function(){return 0===GAME.map.length},console.log("'Allo 'Allo!");var bg_width=$("#map").width();scale(),$(window).resize(function(){scale()}),$(".areas .countur svg path").hover(function(){$(this).closest(".area").toggleClass("active")});var _history=[],_history=["menu"];$("body").on("click","a",function(e){var s=$(this).attr("href").split("#");s[1]&&(openFrame(s[1]),e.preventDefault())}),$("body").on("click",".numpad a",function(e){var s=$(this).closest(".numpad").prev("form").find("input");s.focus(),s.val($(this).hasClass("clear")?"":$(this).hasClass("del")?s.val().slice(0,-1):s.val()+$(this).text()),e.preventDefault()}),$("body").on("click",".popup.with-tabs .tabs-btn a",function(e){e.preventDefault();var s=$(".popup.with-tabs .tabs-btn a").index($(this));$(this).is(".active")||($(".popup.with-tabs .tabs-btn a").removeClass("active"),$(this).addClass("active"),$(".popup.with-tabs .tabs .tab").removeClass("active"),$(".popup.with-tabs .tabs .tab").eq(s).addClass("active"))}),$("#help .q").click(function(){$(this).toggleClass("active"),$(this).next(".a").slideToggle()}),_skoronagame_.open_frame&&openFrame(_skoronagame_.open_frame),$("form").submit(function(e){e.preventDefault();var s=$(this).attr("action"),t=$(this).attr("method"),a=$(this).attr("data-result");$.ajax({type:t,url:s,data:$(this).serialize(),success:function(e){console.log(e),1==e.status?(e.redirect&&(location.href=e.redirect),openFrame(a)):0==e.status&&alert(e)},error:function(e,s,t){console.log(e),console.log(s)}})});