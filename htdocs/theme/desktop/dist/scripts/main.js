function getUserById(e){var s;return $.each(GAME.users,function(t,n){n.id==e&&(s=n)}),s}function getAreaById(e){var s;return $.each(GAME.map,function(t,n){n.zone==e&&(s=n)}),s}function parseGameData(e){if(e.responseJSON.users&&(GAME.users=e.responseJSON.users,$.each(e.responseJSON.users,function(s,t){if(t.id==e.responseJSON.current_user)GAME.user=t;else{var n=!1;$.each(GAME.enemies,function(e,s){s.id==t.id&&(n=!0,GAME.enemies[e]=t)}),0==n&&GAME.enemies.push(t)}})),e.responseJSON.question&&(GAME.question=e.responseJSON.question),GAME.game_id=e.responseJSON.game_id,GAME.stage=e.responseJSON.game_stage,1==last_stage&&2==GAME.stage){var s=$("#help-stage-2").html();$("#sexy-alert").addClass("with-tabs"),sexyAlert(s,10,function(){},440),$("#sexy-alert").find(".close").hide()}last_stage=GAME.stage,GAME.status=e.responseJSON.game_status,GAME.map=e.responseJSON.map||GAME.map,e.responseJSON.settings&&(GAME.next_turn=e.responseJSON.settings.next_step||0,GAME.duel=e.responseJSON.settings.duel?e.responseJSON.settings.duel:{},e.responseJSON.settings.stage2_tours_json&&(GAME.stage2_tours_json=$.parseJSON(e.responseJSON.settings.stage2_tours_json),renderSteps())),GAME.response=e.responseJSON}function startQuizeTimer(){clearInterval(quiz_interval);var e=quiz_timer_default;$("#question-1 .right .timer").text(e),quiz_interval=setInterval(function(){$("#question-1 .right .timer").text(e),e--,0>e&&quizeExpire()},1e3)}function quizeExpire(){clearInterval(quiz_interval),$(".numpad").is(":visible")&&($("#question-1 form.a").find("input").val(99999),$("#question-1 form.a").submit())}function startNormalTimer(){clearInterval(normal_interval);var e=quiz_timer_default;$("#question-2 .timer").text(e),normal_interval=setInterval(function(){$("#question-2 .timer").text(e),e--,0>e&&normalExpire()},1e3)}function normalExpire(){clearInterval(normal_interval),0==$("#question-2 .a a.active").size()&&(GAME.question.answer=99999,GAME.question.time=quiz_timer_default-$("#question-2 .timer").text(),sendQuestionAnswer(function(){getResultQuestion()}))}function compareUsers(e,s){return s.points-e.points}function renderGameOver(){GAME.users.sort(compareUsers),$("#winer .places .first .name").text(GAME.users[0].name),""!=GAME.users[0].photo&&$("#winer .places .first .ava .img").css({"background-image":"url("+GAME.users[0].photo+")"}),$("#winer .places .second .name").text(GAME.users[1].name),""!=GAME.users[1].photo&&$("#winer .places .second .ava .img").css({"background-image":"url("+GAME.users[1].photo+")"}),$("#winer .places .third .name").text(GAME.users[2].name),""!=GAME.users[2].photo&&$("#winer .places .third .ava .img").css({"background-image":"url("+GAME.users[2].photo+")"}),openFrame("winer"),showPoppups()}function quizQuesionRender(e){e=e||[],clearInterval(quiz_interval),clearInterval(normal_interval),renderPlayers(),e.length>0?($("#question-1 .left .unit").hide(),$.each(e,function(e,s){var t=getUserById(s);$("#question-1 .left .unit."+t.color).show()})):0==e.length&&$("#question-1 .left .unit").show(),getQuizQuestion(e,function(){$("#question-1 .left .place").text(""),$("#question-1 .left .timer").text("...").prev(".led").removeClass("red").addClass("black"),$("#question-1 .left .answer").text(""),$("#question-1 .right .answerlkhbdsfksdlhfg").slideUp(),$("#question-1 form.a, #question-1 .numpad, #question-1 .right .timer, #question-1 .right .note-ast").slideDown(),$("#question-1 .right .q").html(GAME.question.text),$("#question-1 .right .answer-true .qa").text(""),$("#question-1 .right .answer-true").slideUp(100),openFrame("question-1"),showPoppups(),startQuizeTimer()})}function takingLand(){getGame(function(){$(".infowindow.tour1").show(),quizQuesionRender()})}function matchmaking(){getGame(function(){"wait"==GAME.status?(renderPlayers(),setTimeout(matchmaking,1e3)):(renderPlayers(),createPlayers(),("start"==GAME.status||"ready"==GAME.status)&&(renderMap(!0),hidePoppups(),console.log("ВНИМАНИЕ!",GAME.status,GAME.stage),0==GAME.stage&&takingLand(),1==GAME.stage&&(setTimeout(function(){var e=$("#help-stage-1").html();$("#sexy-alert").addClass("with-tabs"),sexyAlert(e,10,function(){idleController()},440),$("#sexy-alert").find(".close").hide()},1e3),setTimeout(function(){takingLand()},12e3)),2==GAME.stage&&whoTurn()))})}function renderSteps(){$(".infowindow.tour1").hide(),$(".infowindow.tour2").show(),$.each(GAME.stage2_tours_json,function(e,s){var t=$(".infowindow.tour2 .tour.n"+(e+1));GAME.response&&GAME.response.settings&&GAME.response.settings.current_tour==e?t.addClass("active"):t.removeClass("active"),$.each(s,function(e,s){var n=Object.keys(s)[0],a=(s[n],getUserById(n)),o=t.find(".flag").eq(e);o.removeClass("red green blue").addClass(a.color),GAME.next_turn==n?o.addClass("active"):o.removeClass("active")})})}function tryToConquer(){2==GAME.stage&&"normal"==GAME.question.type,getGame(function(){if(console.log("ВНИМАНИЕ",GAME.stage,GAME.mustConquer,GAME.user.available_steps,GAME.question.result,GAME.question.result[GAME.user.id]),2==GAME.stage&&GAME.mustConquer&&(GAME.user.available_steps>0||GAME.question.result&&1==GAME.question.result[GAME.user.id])){var e=getAreaById(GAME.mustConquer);1==e.capital?sendConquestCapital(GAME.mustConquer,function(e){console.log(e.conquest_result,"Ответ на захват"),"retry"==e.conquest_result&&(console.log("Ходит игрок",GAME.next_turn,getUserById(GAME.next_turn).name,getUserById(GAME.next_turn).color),console.log("повтор!",$("#area-"+GAME.mustConquer),$("#area-"+GAME.mustConquer).size()),setTimeout(function(){hidePoppups(function(){$("#area-"+GAME.mustConquer).click()})},8e3))}):sendConquestEmptyTerritory(GAME.mustConquer,function(e){})}})}function createPlayers(){$.each(GAME.users,function(e,s){GAME.user.id!=s.id?$("#question-1 .left .unit").eq(e).find(".name").text(s.name).addClass(s.color):$("#question-1 .left .unit").eq(e).find(".name").text("Вы").addClass(s.color),$("#question-1 .left .unit").eq(e).addClass(s.color),""!=s.photo&&$("#question-1 .left .unit").eq(e).find(".ava .img").css({"background-image":"url("+s.photo+")"}),$("#question-1 .left .unit").eq(e).addClass(s.color)})}function renderPlayers(){$("#user-list .user").removeClass("active"),$.each(GAME.users,function(e,s){!GAME.resultQuestion||!GAME.resultQuestion[s.id],$("#user-list").show();var t=$("#user-list .user."+s.color);t.find(".name").text(s.name),""!=s.photo&&t.find(".ava .img").css({"background-image":"url("+s.photo+")"}),t.find(".points").text(s.points),s.id==GAME.user.id&&$("#user-list .user."+s.color).find(".name").text("Вы"),s.id==GAME.next_turn&&$("#user-list .user."+s.color).addClass("active")}),$.each(GAME.enemies,function(e,s){0==e&&($("#mathcmaking .ava").first().find(".name").text(s.name),""!=s.photo&&$("#mathcmaking .ava").first().find(".img").css({"background-image":"url("+s.photo+")"})),1==e&&($("#mathcmaking .ava").last().find(".name").text(s.name),""!=s.photo&&$("#mathcmaking .ava").last().find(".img").css({"background-image":"url("+s.photo+")"}))}),""!=GAME.user.photo&&$("#mathcmaking .ava").eq(1).find(".img").css({"background-image":"url("+GAME.user.photo+")"})}function renderMap(e){if(e=e||!1)var s=0;else var s=500;$("#map").addClass("user_"+GAME.user.color),$.each(GAME.map,function(t,n){if(e){var a=parseInt(t)+1,o=$("#map #area-"+a);o.data("zone",n.zone).data("info",n),o.attr("data-zone",n.zone),n.user_id>0?(o.removeClass("empty"),o.addClass("reserved"),o.removeClass("red green blue"),o.addClass(getUserById(n.user_id).color),n.user_id==GAME.user.id?o.addClass("my"):o.removeClass("my"),1==n.capital&&2==n.lives?o.addClass("lives-2"):o.removeClass("lives-2"),1==n.capital&&1==n.lives?o.addClass("lives-1"):o.removeClass("lives-1")):(o.removeClass("reserved"),o.removeClass("my"),o.addClass("empty"))}else setTimeout(function(){$("<div>           capital:"+n.capital+"<br>          id:"+n.id+"<br>          lives:"+n.lives+"<br>          user_id:"+n.user_id+"<br>          zone:"+n.zone+"        </div>").appendTo(".temp-map").css({"background-color":n.settings.color}).data("zone",n.zone)},s*t)})}function orderPlayers(){$("#question-1 .left").find(".unit").sort(function(e,s){return $(e).data("place")-$(s).data("place")}).appendTo("#question-1 .left")}function afterAnswer(){$("#question-1 form.a, #question-1 .numpad, #question-1 .right .timer, #question-1 .right .note-ast").slideUp(100),$("#question-1 .right .answerlkhbdsfksdlhfg").slideDown(100)}function isEmpty(e){if(null==e)return!0;if(e.length>0)return!1;if(0===e.length)return!0;for(var s in e)if(hasOwnProperty.call(e,s))return!1;return!0}function infoWhoTurnText(e,s){s=s||!0,$(".infowindow.who-turn .holder").html(e),s?$(".infowindow.who-turn").show():$(".infowindow.who-turn").hide()}function idleController(){$(document).bind("mousemove keydown scroll",function(){clearTimeout(idleTimer),1==idleState,idleState=!1,idleTimer=setTimeout(function(){var e="Вы отсутствовали более "+idleWait/1e3+" секунд и были отключены от сервера. <a href='' style='font-size:18px'>Обновите страницу</a> чтобы начать новую игру.";hidePoppups(),setInterval(function(){sexyAlert(e,99999,function(){sexyAlert(e,99999,function(){sexyAlert(e,99999,function(){sexyAlert(e,99999,function(){sexyAlert(e,99999,function(){sexyAlert(e,99999,function(){sexyAlert(e,99999,function(){})})})})})})})},100),sexyAlert(e,99999),playerDisconect(),idleState=!0},idleWait)})}function scale(){var e=$(window).width();$("#map").transition({scale:e/bg_width}),$("#user-list").transition({scale:e/bg_width}),$(".infowindow.tour1, .infowindow.tour2, .infowindow.who-turn .holder").transition({scale:e/bg_width})}function openFrame(e){"close"==e?_history.pop():_history.push(e),"mathcmaking"==e&&matchmaking();var s=_history[_history.length-1];$(".popup-wrapper .popup-holder .popup").removeClass("active"),$(".popup-wrapper .popup-holder .popup#"+s).addClass("active")}function sexyAlert(e,s,t,n){s=s||3,t=t||function(){},n=n||320,$("#sexy-alert .note").html()==e||$(".popup-wrapper").is(":visible")||($("#sexy-alert .note").width(n),showPoppups(),$("#sexy-alert .note").html(e),openFrame("sexy-alert"),setTimeout(function(){hidePoppups(),t(),$("#secy-alert").removeClass("with-tabs")},1e3*s))}function hidePoppups(e){e=e||function(){},$(".popup-wrapper").fadeOut(100,function(){e()}),clearInterval(quiz_interval),clearInterval(normal_interval)}function showPoppups(){$(".popup-wrapper").fadeIn(100)}var GAME=GAME||{};GAME.game_id=0,GAME.user={},GAME.enemies=[],GAME.status=0,GAME.stage=0,GAME.response={},GAME.map={},GAME.question={},GAME.steps=0,GAME.user_step=0,GAME.statuses=["wait","start","ready","over"],GAME.users={},GAME.mustConquer=0;var getGame=function(e){e=e||function(){},$.ajax({type:"POST",url:"/game/get-game",data:{game:GAME.game_id},dataType:"json",success:function(s){s.status&&(parseGameData(s),console.log(GAME.status),e(),renderPlayers(),0==GAME.next_turn&&"over"==GAME.status&&overGame())},error:function(s,t,n){getGame(e)}})};getBots=function(){$.ajax({type:"POST",url:"/game/add-bots",data:{game:GAME.game_id},dataType:"json",beforeSend:function(){},success:function(e){e.status&&(GAME.response=e.responseJSON,$("#js-server-response").html(JSON.stringify(GAME.response))),$("#js-server-notification").html(e.responseText)},error:function(e,s,t){clearInterval(GAME.game_timer)}})},playerDisconect=function(){$.ajax({type:"POST",url:idleUrl,data:{game:GAME.game_id,user:GAME.user.id},dataType:"json",success:function(e){e.status},error:function(e,s,t){playerDisconect()}})},overGame=function(){$.ajax({type:"POST",url:"/game/over-game",data:{game:GAME.game_id},dataType:"json",success:function(e){e.status&&(GAME.response=e.responseJSON,renderGameOver())},error:function(e,s,t){overGame()}})},getNormalQuestion=function(e){e=e||function(){},console.log("Получить нормальный вопрос! Данные отправлены:",{game:GAME.game_id,users:GAME.users_question}),$.ajax({type:"POST",url:"/game/question/get-normal",data:{game:GAME.game_id,users:GAME.users_question,zone:GAME.mustConquer},dataType:"json",success:function(s){s.status?(parseGameData(s),e()):getNormalQuestion(e)},error:function(s,t,n){getNormalQuestion(e)}})},getQuizQuestion=function(e,s){s=s||function(){},e=e||GAME.users,2==GAME.stage,$.ajax({type:"POST",url:"/game/question/get-quiz",data:{game:GAME.game_id,users:e},dataType:"json",success:function(t){t.status?(parseGameData(t),s()):getQuizQuestion(e,s)},error:function(t,n,a){getQuizQuestion(e,s)}})},sendConquestEmptyTerritory=function(e,s){s=s||function(){},$.ajax({type:"POST",url:"/game/conquest/territory",data:{game:GAME.game_id,zone:e},dataType:"json",success:function(e){e.status&&(console.log(e,"ОТВЕТ НА ЗАХВАТ"),s(e))},error:function(t,n,a){sendConquestEmptyTerritory(e,s)}})},sendConquestCapital=function(e,s){s=s||function(){},$.ajax({type:"POST",url:"/game/conquest/capital",data:{game:GAME.game_id,zone:e},dataType:"json",success:function(e){e.status&&(console.log(e,"ОТВЕТ НА ЗАХВАТ СТОЛИЦЫ"),s(e))},error:function(t,n,a){sendConquestCapital(e,s)}})};var last_stage;getUsersResultQuestions=function(e){e=e||function(){},$.ajax({type:"POST",url:"/game/question/get-users-results",data:{game:GAME.game_id,question:GAME.question.id,type:GAME.question.type},dataType:"json",success:function(s){s.status&&(console.log(s,"ВНИМАНИЕ!!"),GAME.resultQuestion=s.responseJSON,e())},error:function(s,t,n){getUsersResultQuestions(e)}})},getResultQuestion=function(){$.ajax({type:"POST",url:"/game/question/get-result",data:{game:GAME.game_id,question:GAME.question.id,type:GAME.question.type,zone:GAME.mustConquer},dataType:"json",success:function(e){e.status&&(console.log(e.responseJSON.result),"quiz"==GAME.question.type?"retry"==e.responseJSON.result?setTimeout(getResultQuestion,1e3):"standoff"==e.responseJSON.result?hidePoppups(function(){sexyAlert("Ничья! Будет задан другой вопрос.",void 0,function(){2==GAME.stage?quizQuesionRender([GAME.duel.conqu,GAME.duel.def]):quizQuesionRender()})}):(showQuestionResult(e),2==GAME.stage&&(showQuestionResult(e),tryToConquer())):"normal"==GAME.question.type&&("standoff"===e.responseJSON.result?quizQuesionRender([GAME.duel.conqu,GAME.duel.def]):"retry"===e.responseJSON.result?setTimeout(getResultQuestion,1e3):"object"==typeof e.responseJSON.result&&(console.log("РЕЗУЛЬТАТ!!",e.responseJSON.result),showQuestionResult(e),tryToConquer())))},error:function(e,s,t){getResultQuestion()}})},sendQuestionAnswer=function(e){e=e||function(){},$.ajax({type:"POST",url:"/game/question/send-answer",data:{game:GAME.game_id,question:GAME.question.id,answer:GAME.question.answer,time:GAME.question.time},dataType:"json",success:function(s){s.status&&1==s.status?e():sendQuestionAnswer(e)},error:function(s,t,n){sendQuestionAnswer(e)}})};var firstTime=(new Date).getTime()/1e3,search_timeout=90,quiz_timer_default=10,quiz_interval,normal_interval;$("body").on("click","#question-2 .a a",function(e){e.preventDefault(),0==$("#question-2 .a a.active").size()&&(clearInterval(normal_interval),GAME.question.answer=$(this).data("id"),GAME.question.time=quiz_timer_default-$("#question-2 .timer").text(),$(this).addClass(GAME.user.color),$(this).addClass("active"),sendQuestionAnswer(function(){getResultQuestion()}))}),$("body").on("click","#map .area",function(e){GAME.user.id!=GAME.next_turn||1!=GAME.stage||$(this).hasClass("reserved")?GAME.user.id==GAME.next_turn&&2==GAME.stage&&$(this).data("info").user_id!=GAME.user.id&&(GAME.mustConquer=$(this).data("info").zone,renderNormalQuestion(GAME.user.id,$(this).data("info").user_id)):sendConquestEmptyTerritory($(this).data("zone"),function(){getGame(function(){renderMap(!0)})})}),normalQuestionIsrender=!1,renderNormalQuestion=function(e,s){$(".popup-wrapper").is(":visible")||(normalQuestionIsrender=!0,e=e||GAME.user.id,GAME.users_question={conqu:e,def:s},clearInterval(quiz_interval),clearInterval(normal_interval),getNormalQuestion(function(){clearInterval(quiz_interval),clearInterval(normal_interval),startNormalTimer(),GAME.duel.conqu,GAME.duel.def,GAME.mustConquer&&console.log(GAME.mustConquer);var e="";if(GAME.duel||0==GAME.duel.length){var t=getUserById(s);if(0!=GAME.mustConquer){var n=getAreaById(GAME.mustConquer);e=1==n.capital?'Вы напали на столицу игрока: <span class="'+t.color+'">'+t.name+"</span><br>Осталось жизней столицы: "+n.lives:'Вы напали на игрока: <span class="'+t.color+'">'+t.name+"</span>"}else e='Вы напали на игрока: <span class="'+t.color+'">'+t.name+"</span>"}if(GAME.duel.conqu==GAME.user.id){var t=getUserById(GAME.duel.def);if(console.log(GAME.mustConquer),0!=GAME.mustConquer){console.log(GAME.mustConquer);var n=getAreaById(GAME.mustConquer);console.log("zone!",n),e=1==n.capital?'Вы напали на столицу игрока: <span class="'+t.color+'">'+t.name+"</span><br>Осталось жизней столицы: "+n.lives:'Вы напали на игрока: <span class="'+t.color+'">'+t.name+"</span>"}else e='Вы напали на игрока: <span class="'+t.color+'">'+t.name+"</span>"}if(GAME.duel.def==GAME.user.id){var t=getUserById(GAME.duel.conqu);e='На вас напал игрок: <span class="'+t.color+'">'+t.name+"</span>"}$("#question-2 .small-title").html(e),$("#question-2 .left").removeClass("red green blue"),$("#question-2 .right").removeClass("red green blue"),$("#question-2 .left").addClass(getUserById(GAME.users_question.conqu).color),_photo_left=""!=getUserById(GAME.users_question.conqu).photo?getUserById(GAME.users_question.conqu).photo:"/theme/desktop/dist/images/ava.png",console.log(_photo_left),$("#question-2 .left .ava .img").css({"background-image":"url("+_photo_left+")"}),$("#question-2 .left .score").text(getUserById(GAME.users_question.conqu).points),$("#question-2 .right").addClass(getUserById(GAME.users_question.def).color),$("#question-2 .right .score").text(getUserById(GAME.users_question.def).points),_photo_right=""!=getUserById(GAME.users_question.def).photo?getUserById(GAME.users_question.def).photo:"/theme/desktop/dist/images/ava.png",console.log(_photo_right),$("#question-2 .right .ava .img").css({"background-image":"url("+_photo_right+")"}),$("#question-2 .q").html(GAME.question.text),$("#question-2 .a").html(""),$.each(GAME.question.answers,function(e,s){$('<a href="">'+s+"</a>").appendTo($("#question-2 .a")).data("id",e)}),openFrame("question-2"),showPoppups()}))};var last_turn=0,whoTurn_is_run=!1;whoTurn=function(){whoTurn_is_run=!0,getGame(function(){if(0==GAME.next_turn&&infoWhoTurnText("",!1),GAME.next_turn!=GAME.user.id&&setTimeout(function(){$("body").trigger("mousemove")},1e3),99==GAME.user.status&&sexyAlert('Ваша столица захвачена,<br> игра продолжается между игроками <span class="'+GAME.enemies[0].color+'">'+GAME.enemies[0].name+'</span> и <span class="'+GAME.enemies[1].color+'">'+GAME.enemies[1].name+"</span>",900),1==GAME.stage){if($("#map .areas").addClass("stage-1"),GAME.next_turn==GAME.user.id)2==GAME.user.available_steps&&(sexyAlert("Ваш ход. <br>Выберите 2 территории."),infoWhoTurnText("Ваш ход. <br>Выберите 2 территории.")),1==GAME.user.available_steps&&(sexyAlert("Ваш ход. <br>Выберите 1 территорию."),infoWhoTurnText("Ваш ход. <br>Выберите 1 территорию.")),$("#map .areas").addClass("active"),GAME.next_turn!=last_turn&&(last_turn=GAME.next_turn);else{$("#map .areas").removeClass("active");var e=getUserById(GAME.next_turn);if(e&&(sexyAlert('<span class="'+e.color+'">'+e.name+"</span> выбирает территорию"),infoWhoTurnText('<span class="">'+e.name+"</span> выбирает территорию")),GAME.next_turn!=last_turn){last_turn=GAME.next_turn;var e=getUserById(GAME.next_turn)}0!=GAME.next_turn||$(".popup").is(":visible")||(renderMap(!0),takingLand())}setTimeout(whoTurn,1e3)}else if(2==GAME.stage){if($("#map .areas").removeClass("stage-1"),$("#map .areas").addClass("stage-2"),GAME.next_turn==GAME.user.id)sexyAlert("Выберите территорию для нападения."),infoWhoTurnText("Выберите территорию для нападения.");else{0!=GAME.next_turn&&(GAME.mustConquer=0);var e=getUserById(GAME.next_turn);if(e&&(sexyAlert('<span class="'+e.color+'">'+e.name+"</span> выбирает территорию"),infoWhoTurnText('<span class="">'+e.name+"</span> выбирает территорию")),GAME.next_turn!=last_turn&&(last_turn=GAME.next_turn),!isEmpty(GAME.duel))if(GAME.duel.def==GAME.user.id||GAME.duel.conqu==GAME.user.id)console.log("!!!!"),$(".popup-wrapper").is(":visible")||renderNormalQuestion(GAME.duel.conqu,GAME.duel.def),infoWhoTurnText("",!1);else{var s=getUserById(GAME.duel.conqu),t=getUserById(GAME.duel.def);sexyAlert('Подождите, пока закончится противостояние игроков <span class="'+s.color+'">'+s.name+'</span> и <span class="'+t.color+'">'+t.name+"</span>",10),infoWhoTurnText('Подождите, пока закончится противостояние игроков <span class="">'+s.name+'</span> и <span class="">'+t.name+"</span>")}}"quize"==GAME.question.type||"normal"==GAME.question.type,setTimeout(whoTurn,1e3)}renderMap(!0)})};var showQuestionResult_timeout;showQuestionResult=function(e){GAME.question.result=e.responseJSON.result,clearTimeout(showQuestionResult_timeout),getUsersResultQuestions(function(){"quiz"==GAME.question.type?($("#question-1 .left .unit").hide(),$("#question-1 .right .answer-true .qa").text(GAME.resultQuestion.current_answer),$("#question-1 .right .answer-true").slideDown(100),$.each(GAME.users,function(e,s){var t=GAME.resultQuestion.results[s.id],n=$("#question-1 .left .unit."+s.color);t&&(n.show(),n.data("place",t.place),99999==t.answer&&(t.answer=""),n.find(".place").text(t.place+" Место"),n.find(".timer").text(t.answer),n.find(".timer").prev(".led").removeClass("black").addClass("red"),n.find(".answer").text(t.seconds+" сек."))}),0==whoTurn_is_run&&whoTurn(),orderPlayers()):$.each(GAME.users,function(e,s){var t=GAME.resultQuestion.results[s.id];if(console.log(t),t){var n=getUserById(s.id);1==t.correctly&&($("#question-2 .a a").eq(t.current_answer_index).addClass("true"),$("#question-2 .a a").eq(t.current_answer_index).addClass(n.color)),$('#question-2 .a a:contains("'+s.answer+'")').addClass(n.color)}}),showQuestionResult_timeout=setTimeout(function(){hidePoppups(function(){if(2==GAME.stage){for(var e in GAME.resultQuestion.results)if(1==GAME.resultQuestion.results[e].place){var s=getUserById(e),t=s.name;sexyAlert(GAME.user.id==e?"<span class="+s.color+">Вы</span> выиграли в сражении.":"Игрок <span class="+s.color+">"+t+"</span> выиграл в сражении.")}$.each(GAME.users,function(e,s){console.log(GAME.resultQuestion.results)})}tryToConquer()})},7e3)})},$(document).ready(function(){$("#question-1 form.a").submit(function(){GAME.question.answer=$(this).find("input").val(),$("#question-1 .right .answerlkhbdsfksdlhfg .qa").text(99999!=parseInt(GAME.question.answer)?GAME.question.answer:""),$(this).find("input").val(""),GAME.question.time=quiz_timer_default-$("#question-1 .right .timer").text(),afterAnswer(),sendQuestionAnswer(function(){getResultQuestion()})})}),idleTimer=null,idleState=!1,idleWait=9e5,idleUrl="/game/disconnect_user";var hasOwnProperty=Object.prototype.hasOwnProperty,bg_width=$("#map").width();$(window).resize(function(){scale()}),$(window).load(function(){bg_width=$("#map").width(),scale()}),$(".areas .countur svg path").hover(function(){if($(this).closest(".area").toggleClass("active"),$(this).closest(".area").data("info")){var e=$(this).closest(".area").data("info").points||0;if(1==$(this).closest(".area").data("info").capital){var s=getUserById($(this).closest(".area").data("info").user_id);$(".infowindow-holder .infowindow-small").text("Столица игрока "+s.name+", "+e)}else $(".infowindow-holder .infowindow-small").text(e);$(".infowindow-holder").toggle()}});var _history=[],_history=["menu"];$("body").on("click","a",function(e){var s=$(this).attr("href").split("#");s[1]&&(openFrame(s[1]),e.preventDefault())}),$("body").on("click",".numpad a",function(e){var s=$(this).closest(".numpad").prev("form").find("input");s.focus(),$(this).hasClass("clear")?s.val(""):$(this).hasClass("del")?s.val(s.val().slice(0,-1)):s.val().length<4&&s.val(s.val()+$(this).text()),e.preventDefault()}),$("body").on("click",".popup.with-tabs .tabs-btn a",function(e){e.preventDefault();var s=$(".popup.with-tabs .tabs-btn a").index($(this));$(this).is(".active")||($(".popup.with-tabs .tabs-btn a").removeClass("active"),$(this).addClass("active"),$(".popup.with-tabs .tabs .tab").removeClass("active"),$(".popup.with-tabs .tabs .tab").eq(s).addClass("active"))}),$("#infowindow-question").click(function(e){$(".popup-wrapper").is(":visible")||(showPoppups(),openFrame("help-stage-"+GAME.stage)),e.preventDefault()}),$("#help-stage-2 .close, #help-stage-1 .close").click(function(){hidePoppups()}),$("#help .q").click(function(){$(this).toggleClass("active"),$(this).next(".a").slideToggle()}),_skoronagame_.open_frame&&openFrame(_skoronagame_.open_frame),sendForm=function(e){if($(e).is(".noajax"))return alert("!!!"),!1;console.log(e),console.log($(e));var s=$(e).attr("action"),t=$(e).attr("method"),n=$(e).attr("data-result");$.ajax({type:t,url:s,data:$(e).serialize(),success:function(s){console.log(s),1==s.status?(s.redirect&&(location.href=s.redirect),openFrame(n)):0==s.status&&$(e).prepend('<label class="error">'+s.responseText+"</label>")},error:function(e,s,t){console.log(e),console.log(s)}})},$("#login form").validate({rules:{email:{required:!0,email:!0},password:"required"},messages:{email:{required:"Обязательное поле",email:"Неверный формат. Попробуйте еще"},password:"Обязательное поле"},submitHandler:function(e){sendForm(e)}}),$("#register form").validate({rules:{email:{required:!0,email:!0},name:"required"},messages:{email:{required:"Обязательное поле",email:"Неверный формат. Попробуйте еще"},name:"Обязательное поле"},submitHandler:function(e){sendForm(e)}}),$.validator.addMethod("passRegex",function(e,s){return this.optional(s)||/^[a-z0-9\-]+$/i.test(e)},"Username must contain only letters, numbers, or dashes."),$("#new-password form").validate({rules:{password:{required:!0,minlength:6,passRegex:!0},ver_password:{required:!0,equalTo:"#password"}},messages:{password:{required:"Обязательное поле",minlength:"Должно быть не мение 6 символов",passRegex:"Используйте латинский алфавит<br> и цифры"},ver_password:{required:"Обязательное поле",equalTo:"Пароли не совпадают"}},submitHandler:function(e){sendForm(e)}}),$("form").submit(function(e){return $(this).is(".noajax")?!1:void 0});